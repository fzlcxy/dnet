# 协议配置GUI工具使用文档

## 概述

协议配置GUI工具用于配置C2S（客户端到服务端）协议与S2C（服务端到客户端）回包之间的映射关系。通过可视化界面，您可以方便地管理每个C2S请求对应的S2C响应配置。

## 启动方式

```bash
cd clientscript
python gui_main_window.py
```

## 界面布局

界面分为左右两个主要区域：

### 左侧面板
- **选择C2S协议文件**：显示所有dnet协议文件的树形结构，可通过过滤框筛选，勾选"仅C2S"只显示包含C2S协议的文件
- **选择S2C协议**：双击S2C协议可将其添加到当前C2S的回包配置中
- **C2S详情**：显示当前选中C2S协议的详细信息（字段列表等）

### 右侧面板
- **C2S协议列表**：显示当前选中dnet文件中的所有C2S协议
- **S2C回包配置**：显示当前C2S协议配置的所有S2C响应
- **S2C详情**：显示选中S2C协议的详细信息

## 基本操作

### 1. 设置目录
首次使用或需要切换项目时：
1. 点击菜单 **文件 → 设置目录**
2. 设置Proto目录（包含.dnet协议文件的目录）
3. 设置配置输出目录（保存配置JSON文件的目录）
4. 点击确定

> 注：目录设置会自动保存到本地，下次启动时自动加载。

### 2. 选择C2S协议
1. 在左上方的协议文件树中选择一个dnet文件
2. 右侧C2S协议列表会显示该文件中的所有C2S协议
3. 点击选择要配置的C2S协议

### 3. 添加S2C响应
1. 在左下方选择包含S2C协议的dnet文件
2. 在S2C协议列表中找到目标协议
3. **双击**该S2C协议，即可添加到当前C2S的回包配置中

### 4. 编辑S2C响应配置
在S2C回包配置列表中**双击**某一行，可编辑以下属性：
- **类型**：必然回包 / 条件回包 / 可选回包
- **次数**：一次 / 多次
- **条件说明**：描述触发该回包的条件
- **顺序组**：用于标识返回顺序不确定的响应组

### 5. 调整响应顺序
- **右键菜单**：选中行后右键，选择"上移"或"下移"
- **快捷键**：Ctrl+Up / Ctrl+Down

### 6. 删除响应
- 选中行后右键，选择"删除"
- 或选中后按 Delete 键

### 7. 保存配置
- 快捷键：**Ctrl+S**
- 菜单：**文件 → 保存**

配置文件会保存到配置输出目录，文件名与dnet文件对应（如 `nethero.json`）。

## 顺序组功能

当多个S2C响应的返回顺序不确定时，可以使用顺序组功能：

1. 双击响应行打开编辑对话框
2. 在"顺序组"下拉框中选择已有组或输入新组名（如 A、B）
3. 同一顺序组的响应会在列表中显示相同的背景色
4. 可通过右键菜单"编辑顺序组说明"为组添加说明文字

## 快捷键列表

| 快捷键 | 功能 |
|--------|------|
| Ctrl+S | 保存配置 |
| Ctrl+Z | 撤销 |
| Ctrl+Y | 重做 |
| F5 | 刷新协议文件列表 |
| Delete | 删除选中的响应 |
| Ctrl+Up | 上移选中行 |
| Ctrl+Down | 下移选中行 |

## 配置文件格式

配置文件为JSON格式，示例：

```json
{
  "dnet_file": "nethero.dnet",
  "description": "英雄相关协议",
  "c2s_mappings": {
    "C2SUpdateHeroName": {
      "description": "更新英雄名称",
      "order_groups": [
        {
          "name": "A",
          "description": "这两个包的返回顺序不确定"
        }
      ],
      "responses": [
        {
          "protocol": "S2CUpdateHero",
          "order": 1,
          "type": "必然回包",
          "condition": "",
          "count": "一次",
          "order_group": "A"
        },
        {
          "protocol": "S2CAddHero",
          "order": 2,
          "type": "必然回包",
          "condition": "",
          "count": "一次",
          "order_group": "A"
        }
      ]
    }
  }
}
```

## 状态栏说明

窗口底部状态栏显示：
- 左侧：当前操作状态信息
- 中间：文件修改状态（"已修改"表示有未保存的更改）
- 右侧：统计信息（已配置的C2S数量和S2C响应总数）

## 常见问题

**Q: 为什么看不到某些协议文件？**
A: 检查Proto目录设置是否正确，或使用F5刷新文件列表。

**Q: 如何快速找到特定协议？**
A: 使用左上方的过滤框输入关键字进行筛选。

**Q: 配置保存在哪里？**
A: 保存在设置的"配置输出目录"中，文件名与对应的dnet文件名相同，扩展名为.json。
